---
name: 6.2
title: 6.2 - Weighted Fair Queuing (WFQ)
short-title: Weighted Fair Queuing
category: 6 QoS
collection: qos
layout: page
exam: both
sidebar: qos_sidebar
permalink: 6.2.html
folder: qos
---
First a little on FIFO and Priority queuing. FIFO queuing, unlike other queuing methods, does not require classification or marking. You must remember that to configure FIFO queuing, all you have to do is make sure all other queuing methods are disabled in IOS (WFQ is enabled by default). We saw previously that to override the default queu length, use the command **hold-queue 30 out**.
```
R1(config-if)# no fair-queue
R1(config-if)# hold-queue 30 out
R1(config-if)# exit
```

Priority Queuing works by always ensuring that the higher priority queues always get serviced first. Think of 4 buckets and if the first bucket has tokens, then tokens are always removed first from the top bucket. Priority Queuing starves lower queues, and is therefore an unpopular choice today.


WFQ, along with CBWFQ and LLQ, are the most popular IOS queuing tools. WFQ does not allow classification options to be configured in any way! WFQ classifies packets based on flows. The WFQ scheduler prefers low-volume, higher precedence flows over large-volume, low precedence flows. There can be up to 4096 queues (in multiple of 2 raised between $$2^4$$ and $$2^{12}$$) per interface to support the various concurrent flows that may be traversing the router at any given time. WFQ is the easiest tool queing tool to configure in IOS, but requires the most explanation.

WFQ classifies flows based on at least 5 of the below items:
- Source IP address
- Destination IP address
- TCP or UDP
- source port
- destination port
- IP precedence

One thing to remember about WFQ is that it only considers a flow to be active if packets from that flow need to be enqueued. So the TCP connection could be up, packets could be in the process of transmission, but WFQ would not indicate the flow if packets can be sent directly to the TX-Ring.

The WFQ scheduler works to ensure fairness among flows. Available bandwidth is evenly divided among the active flows. The downside of this is that higher-volume flows suffer while lower-volume flows prosper. The secondary purpose of the scheduler is to provide more bandwidth to flows with higher IP Precedence values. This is where "Weighted" from WFQ comes into play. Higher precedence flows receive a weight, generally equal to the ratio of each flow's precedence, plus 1. In other words, IP Precedence 7 flows get 8 times more bandwidth than IP Precedence 0 flows. becasue (7+1 = 8) is 8 times (0+1 = 1).

WFQ is therefore a great solution where most of the delay-sensitive traffic is low volume. When it came out, Telnet and SNA were two of the more important delay sensitive flows, and it worked great for that purpose. However, WFQ is a bad choice for voice and video, so it is rarely implemented today.

WFQ places an absolute limit on the number of packets enqueued amond all queues, with a parameter called the *hold-queue limit*. If a new packet arrives and the hold-queue limit has been reached, the packet is discarded. In addition, each queue has a *congestive discard threshold* and if the CDT has reached its limt, any newly arriving packets destined for that queue *can* be dsicarded. Notice we say *can*, becuase WFQ puts a twist. If a packet with a larger SN has been enqueued into another queue, WFQ will discard the packet with the larger SN and keep the newly arriving packet taht did not have room in its own CDT queue!

WFQ keeps eight hidden queues for overhead traffic generated by the router. These queues are given a very low weight to give preference to this router generated traffic.

Configuration is a maximum of two lines in interface configuration mode.
```
R1(config-if)# fair-queue
R1(config-if)# hold-queue <LENGTH> out
R1(config-if)# exit
```

There are two show commands to know as well.
```
R1# show queue
R1# show queuing
```
I did not even see WFQ as a configuration option in VIRL, perhaps because there are no serial interfaces?





 